# Blog Post Workflow with Automated Images

This guide explains the streamlined workflow for creating blog posts with automatically generated branded images.

## Quick Start

1. **Place source image** in `src/images/sources/` with a descriptive filename
2. **Create blog post** in `src/posts/`
3. **Run build** - images are generated automatically!

That's it! The build pipeline handles everything else.

## Detailed Workflow

### Step 1: Prepare Your Source Image

Place your high-quality source image in the sources directory:

```bash
src/images/sources/
â””â”€â”€ your-post-title.jpg  # Use the post slug as filename
```

**Naming Convention:**
The filename should match your blog post slug (lowercase, hyphens instead of spaces).

**Examples:**
- Post title: "Health Optimization Guide" â†’ `health-optimization-guide.jpg`
- Post title: "Building Muscle After 40" â†’ `building-muscle-after-40.jpg`

**Image Requirements:**
- Format: JPG, PNG, or WebP
- Minimum size: 1200x630px (larger recommended)
- Good lighting and contrast
- Landscape orientation (16:9 ideal)

### Step 2: Create Your Blog Post

Create a markdown file in `src/posts/`:

```markdown
---
title: "Health Optimization Guide"
description: "Your comprehensive guide to health optimization"
date: 2025-01-15
tags: ["health", "longevity"]
layout: post.njk
permalink: "/blog/health-optimization-guide/"
image: "/images/posts/health-optimization-guide-hero.jpg"
ogImage: "/images/posts/health-optimization-guide-og.png"
---

Your blog post content here...
```

**Important:** The slug in the `image` and `ogImage` paths should match your source image filename.

### Step 3: Build Your Site

```bash
npm run build
```

The build process will:
1. âœ… Scan all blog posts
2. âœ… Check for missing images
3. âœ… Find matching source images
4. âœ… Generate thumbnail, hero, and OG images automatically
5. âœ… Build the site with all images included

### Step 4: Review Generated Images

Check the output:

```bash
src/images/posts/
â”œâ”€â”€ health-optimization-guide-thumb.jpg  (350x200)
â”œâ”€â”€ health-optimization-guide-hero.jpg   (1200x630)
â””â”€â”€ health-optimization-guide-og.png     (1200x630)
```

### Step 5: Deploy

```bash
./deploy.sh
```

Your blog post is now live with professionally branded images! ğŸš€

## Directory Structure

```
withstain/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ sources/              # Place source images here
â”‚   â”‚   â”‚   â”œâ”€â”€ post-1.jpg
â”‚   â”‚   â”‚   â”œâ”€â”€ post-2.png
â”‚   â”‚   â”‚   â””â”€â”€ post-3.webp
â”‚   â”‚   â””â”€â”€ posts/                # Generated images (auto-created)
â”‚   â”‚       â”œâ”€â”€ post-1-thumb.jpg
â”‚   â”‚       â”œâ”€â”€ post-1-hero.jpg
â”‚   â”‚       â”œâ”€â”€ post-1-og.png
â”‚   â”‚       â”œâ”€â”€ post-2-thumb.jpg
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ posts/                    # Your blog posts
â”‚       â”œâ”€â”€ 2025-01-15-post-1.md
â”‚       â””â”€â”€ 2025-01-16-post-2.md
â””â”€â”€ scripts/
    â”œâ”€â”€ generate-images.js        # Manual image generation
    â””â”€â”€ process-post-images.js    # Automatic processing
```

## When Images Are Generated

Images are generated automatically in these scenarios:

### 1. During Build (Automatic)

```bash
npm run build
```

The `prebuild` script runs automatically before building and generates any missing images.

### 2. Manual Processing

```bash
npm run process-images
```

Scans all posts and generates missing images without building the site.

### 3. Manual Generation (Single Post)

```bash
npm run generate-images source.jpg "Post Title" src/images/posts
```

For one-off manual image generation.

## Smart Caching

The system is smart about regeneration:

- âœ… **Images exist?** â†’ Skipped (fast builds)
- âœ… **Source image exists but no generated images?** â†’ Generated
- âœ… **No source image?** â†’ Skipped with helpful message

This means:
- First build: Generates all missing images
- Subsequent builds: Only generates new images (fast!)
- Want to regenerate? Delete the old images, they'll be recreated

## Slug Matching

The system uses slugs to match source images to posts:

**Post Title** â†’ **Slug** â†’ **Source Filename**

Examples:
- "Health Optimization" â†’ `health-optimization` â†’ `health-optimization.jpg`
- "Building Muscle After 40" â†’ `building-muscle-after-40` â†’ `building-muscle-after-40.jpg`
- "The Science Behind IF" â†’ `the-science-behind-if` â†’ `the-science-behind-if.jpg`

The slug is generated by:
1. Converting to lowercase
2. Replacing non-alphanumeric characters with hyphens
3. Removing leading/trailing hyphens

## Troubleshooting

### "No source image found"

**Problem:** You see this warning during build:
```
âš ï¸  No source image found in src/images/sources/your-post.[jpg|png|webp]
```

**Solution:**
1. Check that your source image filename matches the post slug
2. Verify the image is in `src/images/sources/`
3. Ensure the file extension is .jpg, .jpeg, .png, or .webp

### Images not showing on website

**Problem:** Build succeeds but images don't appear.

**Solution:**
1. Check the image paths in your frontmatter are correct
2. Verify generated images exist in `_site/images/posts/`
3. Clear browser cache
4. Redeploy

### Want to regenerate existing images

**Solution:**
```bash
# Delete old images
rm src/images/posts/your-post-*

# Regenerate
npm run build
```

### Build is slow

**Cause:** Generating many images at once.

**Solution:**
- Images are only generated once (subsequent builds are fast)
- Pre-generate images before committing:
  ```bash
  npm run process-images
  git add src/images/
  ```

## Manual Override

Want to use custom images instead of generated ones?

1. Place your custom images in `src/images/posts/`
2. Name them with the post slug (e.g., `my-post-hero.jpg`)
3. The build script will skip generation if images exist

## Best Practices

### 1. **Name Source Images Correctly**
```bash
# Good
src/images/sources/longevity-science.jpg

# Bad (won't match)
src/images/sources/IMG_1234.jpg
```

### 2. **Use High-Quality Sources**
- Minimum 1920x1080px
- Well-lit and clear
- Landscape orientation

### 3. **Organize Source Images**
```bash
src/images/sources/
â”œâ”€â”€ 2025-01-health-post.jpg
â”œâ”€â”€ 2025-01-fitness-post.jpg
â””â”€â”€ 2025-02-nutrition-post.jpg
```

### 4. **Commit Source Images**
```bash
# Good workflow
git add src/images/sources/new-post.jpg
git add src/posts/new-post.md
git commit -m "Add new blog post with images"
```

Generated images are also committed (they're small and optimized).

### 5. **Pre-process Before Deploying**
```bash
# Optional: Generate images before build
npm run process-images

# Then build
npm run build
```

## CI/CD Integration

The automated workflow works great in CI/CD:

```yaml
# Example GitHub Actions
- name: Install dependencies
  run: npm ci

- name: Build site
  run: npm run build
  # Images are generated automatically during prebuild

- name: Deploy
  run: ./deploy.sh
```

## Development Workflow

### Option A: Generate During Development

```bash
# Add source image
cp ~/Downloads/photo.jpg src/images/sources/my-new-post.jpg

# Create post
vim src/posts/2025-01-15-my-new-post.md

# Start dev server (build includes image generation)
npm start
```

### Option B: Pre-generate Then Develop

```bash
# Add source image
cp ~/Downloads/photo.jpg src/images/sources/my-new-post.jpg

# Create post
vim src/posts/2025-01-15-my-new-post.md

# Generate images
npm run process-images

# Start dev server
npm start
```

## Performance Notes

- **First build with images:** ~2-3 seconds per post
- **Subsequent builds:** ~0.1 seconds (images cached)
- **Large source images:** Use optimized sources to speed up generation

## Summary

The automated workflow makes it easy to maintain consistent, branded images across all blog posts:

1. ğŸ“ Drop source image in `src/images/sources/`
2. âœï¸ Write your blog post
3. ğŸ”¨ Run `npm run build`
4. âœ… Done! Images generated automatically

No manual image editing required! ğŸ‰
