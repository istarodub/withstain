---
pagination:
  data: topicsArray
  size: 1
  alias: topicData
  addAllPagesToCollections: true
permalink: /topics/{{ topicData[0] }}/
layout: base.njk
eleventyComputed:
  tag: "{{ topicData[0] }}"
  title: "{{ topicData[1].display }}"
  description: "{{ topicData[1].description }}"
---

<section class="page-intro">
  <div class="container">
    <span class="eyebrow">Topic</span>
    <h1>{{ title }}</h1>
    <p class="lead">{{ description }}</p>
  </div>
</section>

<section>
  <div class="container">
    {%- set taggedPosts = collections[tag] | reverse -%}

    {% if taggedPosts.length > 0 %}
    <div class="articles-grid">
      {%- for post in taggedPosts -%}
      <a href="{{ post.url }}" class="article-link">
        <article class="article-card">
          <div class="article-label">
            {% if post.data.tags and post.data.tags[0] %}
              {{ post.data.tags[0] | formatTag }}
            {% else %}
              Article
            {% endif %}
          </div>
          <h2 class="article-title">{{ post.data.title }}</h2>
          {% if post.data.preview %}
            <p class="article-excerpt">{{ post.data.preview | truncate(150) }}</p>
          {% elif post.data.description %}
            <p class="article-excerpt">{{ post.data.description | truncate(150) }}</p>
          {% endif %}
          <div class="article-meta">
            <time datetime="{{ post.date | dateToFormat('yyyy-MM-dd') }}" class="post-date">
              {{ post.date | readableDate }}
            </time>
          </div>
        </article>
      </a>
      {%- endfor -%}
    </div>
    {% else %}
    <div class="container-narrow">
      <div class="no-posts">
        <h3>No articles on this topic yet</h3>

        {%- set topicsWithCounts = [] -%}
        {%- for topic in topicsArray -%}
          {%- set topicSlug = topic[0] -%}
          {%- set topicPosts = collections[topicSlug] -%}
          {%- if topicPosts and topicPosts.length > 0 and topicSlug != tag -%}
            {%- set topicsWithCounts = (topicsWithCounts.push({slug: topicSlug, data: topic[1], count: topicPosts.length}), topicsWithCounts) -%}
          {%- endif -%}
        {%- endfor -%}

        {%- set sortedTopics = topicsWithCounts | sort(attribute='count') | reverse -%}

        {% if sortedTopics.length > 0 %}
          <p class="lead">We're constantly publishing new content. In the meantime, explore our other topics:</p>
          <div class="related-topics">
            {% set displayCount = 0 %}
            {% for topic in sortedTopics %}
              {% if displayCount < 6 %}
                <a href="/topics/{{ topic.slug }}/" class="related-topic-card">
                  <h4>{{ topic.data.display }}</h4>
                  <p>{{ topic.data.description }}</p>
                  <span class="post-count">{{ topic.count }} article{{ 's' if topic.count != 1 }}</span>
                </a>
                {% set displayCount = displayCount + 1 %}
              {% endif %}
            {% endfor %}
          </div>
        {% else %}
          <p class="lead">We're constantly publishing new content. Check back soon for articles on this topic.</p>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
</section>

<div class="container-narrow">
  <nav class="post-nav">
    <a href="/articles/" class="btn btn-secondary">
      ‚Üê Back to Articles
    </a>
  </nav>
</div>
